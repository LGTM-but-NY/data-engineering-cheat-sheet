\documentclass[landscape]{article}
\sloppy
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{geometry}
\usepackage{ulem}
\usepackage{multicol} % for multi-column layout
\usepackage{xcolor}
\usepackage{booktabs}
\usepackage{array}
\usepackage[inline]{enumitem} % to tighten list spacing

% --- VIETNAMESE SUPPORT PACKAGES ---
\usepackage[utf8]{inputenc}
\usepackage[T5]{fontenc}
\usepackage[vietnamese]{babel}
% -----------------------------------

% Tight margins for cheat sheet in landscape (A4 297mm x 210mm)
\geometry{a4paper, landscape, left=8mm, right=8mm, top=8mm, bottom=8mm}

\title{Tổng hợp Kiến thức Kỹ thuật Dữ liệu (Data Engineering)}
\author{Học viên Cao học KHMT Bách Khoa TP.HCM (HCMUT)}
\date{\today}

\begin{document}

\maketitle
\footnotesize % smaller font for dense content
% Zero / minimal spacing in itemize and enumerate lists
\setlist{itemsep=0pt,topsep=2pt,parsep=0pt,partopsep=0pt}
\begin{multicols}{3}
    \setlength{\columnsep}{8pt} % space between columns
    \setlength{\multicolsep}{2pt} % vertical space before/after multicols
    \raggedcolumns

    \section{Nguyên lý Phân tích \& Thiết kế CSDL}

    \subsection{Tổng quan Các giai đoạn Thiết kế}
    \begin{enumerate}[leftmargin=*,itemsep=2pt]
        \item \textbf{Mức Quan niệm (Conceptual):} \textit{Mục tiêu} — nắm bắt yêu cầu và ngữ nghĩa (độc lập với cài đặt); \textit{Mô hình/Công cụ} — ER/EER; \textit{Đầu ra} — lược đồ quan niệm (thực thể, thuộc tính, mối kết hợp, ràng buộc).
        \item \textbf{Mức Logic:} \textit{Mục tiêu} — ánh xạ từ mức quan niệm sang mô hình DBMS đích (ví dụ: quan hệ); \textit{Mô hình/Công cụ} — ánh xạ ER-sang-quan hệ, chuẩn hóa (FDs); \textit{Đầu ra} — lược đồ quan hệ (bảng, khóa, ràng buộc toàn vẹn).
        \item \textbf{Mức Vật lý:} \textit{Mục tiêu} — xác định cấu trúc lưu trữ và đường dẫn truy xuất để tối ưu hiệu năng; \textit{Mô hình/Công cụ} — phân tích tải, chỉ mục, tổ chức tập tin, băm; \textit{Đầu ra} — lược đồ trong (cấu trúc lưu trữ, chỉ mục, đường dẫn truy xuất).
    \end{enumerate}

    \subsection{Nguyên lý Thiết kế Mức Quan niệm}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Phân tích Yêu cầu:} Làm việc với người dùng/chuyên gia nghiệp vụ để nắm bắt yêu cầu dữ liệu và yêu cầu chức năng (thao tác/giao dịch).
        \item \textbf{Thành phần ER:} \textbf{Thực thể} (vd: NhanVien), \textbf{Thuộc tính} (đơn/phức hợp/đa trị/dẫn xuất), \textbf{Mối kết hợp} (sự liên kết giữa các thực thể).
        \item \textbf{Ràng buộc Cấu trúc:} Tỷ số bản số (1:1, 1:N, M:N) và ràng buộc tham gia (\textit{toàn phần} vs \textit{từng phần}).
        \item \textbf{Thực thể Yếu:} Được xác định thông qua \textbf{mối kết hợp xác định} với một thực thể \textbf{chủ} và một \textbf{khóa bộ phận}; thực thể yếu tham gia \textit{toàn phần} vào mối kết hợp xác định.
        \item \textbf{Tinh chỉnh Top-Down:} Tinh chỉnh lặp lại các thực thể tổng quát; áp dụng chuyên biệt hóa/tổng quát hóa (EER).
    \end{itemize}
    
    \subsection{Nguyên lý Thiết kế Mức Logic}
    \subsubsection{Cơ bản về Mô hình Quan hệ}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Cấu trúc:} Lược đồ quan hệ $R(A_1, \dots, A_n)$; các bộ (tuple) không có thứ tự và không cho phép trùng lặp trong mô hình hình thức.
        \item \textbf{Ràng buộc Toàn vẹn:} Ràng buộc miền giá trị (nguyên tố, có kiểu), ràng buộc khóa (siêu khóa/khóa ứng viên/khóa chính), toàn vẹn thực thể (khóa chính không NULL), toàn vẹn tham chiếu (giá trị khóa ngoại phải xuất hiện trong khóa chính được tham chiếu).
    \end{itemize}

    \subsubsection{Lý thuyết Chuẩn hóa (Normalization Theory)}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Mục tiêu:} Giảm thiểu dư thừa, tránh dị thường (Thêm, Xóa, Sửa).
        \item \textbf{Phụ thuộc Hàm (FD):} $X \rightarrow Y$ (Nếu $t_1[X]=t_2[X]$ thì $t_1[Y]=t_2[Y]$).
        \item \textbf{Các loại Key:}
        \begin{itemize}
            \item \textit{Superkey:} Xác định duy nhất một bộ.
            \item \textit{Candidate Key:} Superkey tối thiểu.
            \item \textit{Prime Attribute:} Thuộc tính nằm trong bất kỳ Candidate Key nào.
        \end{itemize}
    \end{itemize}

    \textbf{Các Dạng Chuẩn (Normal Forms)}
    \begin{center}
        \includegraphics[width=0.8\linewidth, height=3cm, keepaspectratio]{./images/normalization_pyramid.png} \\
        \footnotesize \textit{(Hierarchy: BCNF $\subset$ 3NF $\subset$ 2NF $\subset$ 1NF)}
    \end{center}

    \begin{description}[leftmargin=*, labelindent=0pt, font=\bfseries\color{blue!80!black}, nosep]
        
        \item[1NF (Atomic):] Miền giá trị nguyên tố.
        \newline $\hookrightarrow$ \textit{Vi phạm:} Thuộc tính đa trị, lồng nhau, lặp lại nhóm.

        \item[2NF (No Partial):] Là 1NF + Thuộc tính \textit{non-prime} phụ thuộc đầy đủ vào khóa.
        \newline $\hookrightarrow$ \textit{Vi phạm:} $\exists X \subsetneq Key$ sao cho $X \rightarrow NonPrime$.
        \newline \textit{(Chỉ xảy ra nếu Key là khóa phức hợp)}.

        \item[3NF (No Transitive):] Là 2NF + Không có phụ thuộc bắc cầu giữa các \textit{non-prime}.
        \newline $\rightarrow$ \textit{Định nghĩa:} Với mọi $X \rightarrow A$ (không tầm thường), phải thỏa:
        \begin{enumerate*}[label=(\alph*)]
            \item $X$ là Superkey \textbf{HOẶC}
            \item $A$ là Prime Attribute.
        \end{enumerate*}

        \item[BCNF (Strict):] Nghiêm ngặt hơn 3NF.
        \newline $\rightarrow$ \textit{Định nghĩa:} Với mọi $X \rightarrow A$, $X$ \textbf{bắt buộc là Superkey}.
        \newline \textit{(Khác biệt: BCNF không chấp nhận ngoại lệ "A là Prime" như 3NF)}.

    \end{description}

    \textbf{Tính chất Phân rã (Decomposition Properties)}
    \begin{enumerate}[leftmargin=*, label={\arabic*.}]
        \item \textbf{Kết nối bảo toàn thông tin (Lossless Join):} \textit{(Bắt buộc)}
        \newline Để phân rã $R$ thành $R_1, R_2$ không bị mất dữ liệu, điều kiện là:
        \newline $(R_1 \cap R_2) \rightarrow R_1$ \textbf{HOẶC} $(R_1 \cap R_2) \rightarrow R_2$.
        \newline \textit{(Giao của 2 bảng phải là khóa của ít nhất 1 bảng).}
        \item \textbf{Bảo toàn phụ thuộc (Dependency Preservation):}
        \newline Các FD ban đầu có thể được kiểm tra riêng lẻ trên từng $R_i$ mà không cần join lại. (BCNF có thể không bảo toàn phụ thuộc).
    \end{enumerate}

    \subsubsection{Phi chuẩn hóa (Denormalization)}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Mục tiêu:} Cải thiện hiệu suất đọc bằng cách đưa dư thừa vào lược đồ, ngược với chuẩn hóa.
        \item \textbf{Động lực:} Tránh Join tốn kém; giảm độ phức tạp truy vấn; tăng locality dữ liệu.
    \end{itemize}
    
    \textbf{Kỹ thuật Denormalization:}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Materialized Views:} Kết quả truy vấn được tính trước và lưu trữ; cập nhật khi dữ liệu thay đổi.
        \item \textbf{Precomputed Aggregates:} Lưu giá trị tổng hợp (COUNT, SUM) trong bản ghi để tránh tính lại.
        \newline \textit{VD: Lưu số email chưa đọc trong bảng User thay vì đếm mỗi lần.}
        \item \textbf{Document Databases:} Nhúng (embedding) dữ liệu liên quan trong một document thay vì tham chiếu.
        \newline \textit{VD: MongoDB nhúng thông tin Worker vào document Project.}
        \item \textbf{Star Schema (DW):} Dimension tables được denormalize (VD: Brand, Category trong dim\_product).
        \item \textbf{Microservices:} Sao chép (replicate) dữ liệu giữa các service để tách biệt và giảm phụ thuộc.
    \end{itemize}
    
    \textbf{Đánh đổi (Trade-offs):}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Write Overhead:} Mỗi cập nhật phải sửa tất cả bản sao dư thừa $\Rightarrow$ ghi chậm hơn, phức tạp hơn.
        \item \textbf{Data Inconsistency:} Rủi ro không nhất quán nếu một bản sao được cập nhật mà bản khác thì không.
        \item \textbf{Storage Cost:} Lưu trữ dữ liệu trùng lặp tốn bộ nhớ hơn.
    \end{itemize}
    \textit{Khi nào dùng:} OLAP/DW (đọc nhiều), NoSQL (thiếu join), microservices (tách biệt). \textit{Tránh:} OLTP cần ACID chặt.

    \subsubsection{Bẫy Thiết kế CSDL (Design Traps)}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Bẫy Kết nối trong ER:}
        \begin{center}
            \begin{tabular}{@{} c c @{}}
                \includegraphics[width=0.45\linewidth]{./images/design_trap_fan.png} & 
                \includegraphics[width=0.45\linewidth]{./images/design_trap_chasm.png} \\
                \footnotesize (Fan Trap) & \footnotesize (Chasm Trap) \\
            \end{tabular}
        \end{center}
        \begin{itemize}
            \item \textit{Fan Trap:} Đường dẫn giữa các thực thể mơ hồ do nhiều quan hệ 1:N phân nhánh từ một thực thể. VD: NhanVien $\to$ PhongBan $\to$ ChiNhanh (không xác định được nhân viên làm ở chi nhánh nào). \textit{Giải pháp:} Thêm quan hệ trực tiếp NhanVien-ChiNhanh.
            \item \textit{Chasm Trap:} Đường dẫn không tồn tại do tham gia tùy chọn. VD: KhanhHang $\to$ TaiSan $\to$ ChiNhanh (nếu tài sản chưa niêm yết thì không liên kết được khách hàng với chi nhánh). \textit{Giải pháp:} Đổi sang tham gia bắt buộc hoặc thêm quan hệ trực tiếp.
        \end{itemize}
        \item \textbf{Dị thường Cập nhật (Update Anomalies):} Do thiết kế không chuẩn hóa:
        \begin{itemize}
            \item \textit{Insertion:} Không thể thêm phòng ban mới nếu chưa có nhân viên.
            \item \textit{Deletion:} Xóa nhân viên cuối cùng làm mất thông tin phòng ban.
            \item \textit{Modification:} Thay đổi tên phòng ban phải cập nhật nhiều bộ.
        \end{itemize}
        \item \textbf{Bộ giả (Spurious Tuples):} Kết nối các quan hệ phân rã sai (không qua PK/FK hợp lệ) tạo ra bản ghi ảo. \textit{Giải pháp:} Dùng phân rã bảo toàn thông tin (lossless join).
        \item \textbf{Bẫy NULL:} Quá nhiều thuộc tính NULL lãng phí bộ nhớ và gây khó khăn trong truy vấn tổng hợp.
        \item \textbf{Sai lầm phổ biến:} Dùng PK của thực thể này làm thuộc tính của thực thể khác thay vì mô hình hóa quan hệ; gán PK vào thuộc tính của quan hệ; dùng thuộc tính đơn trị khi cần đa trị.
        \item \textbf{Entity Trap (Kiến trúc):} Thiết kế component 1-1 với bảng DB (VD: CustomerManager cho bảng Customer) thay vì theo workflow nghiệp vụ $\to$ vi phạm tách biệt dữ liệu trong microservices.
    \end{itemize}
    \textit{Thực hành tốt:} Dùng BCNF/3NF; phân rã bảo toàn thông tin; đảm bảo đường dẫn ER rõ ràng; thiết kế theo hành vi nghiệp vụ, không theo thực thể.

    \subsection{Nguyên lý Thiết kế Mức Vật lý}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Kiến trúc Lưu trữ:} Dữ liệu bền vững trên đĩa/SSD trong các \textbf{khối (block)} kích thước cố định.
        \item \textbf{Phân tích Tải (Job Mix):} Xác định các quan hệ/tập tin thường truy cập, điều kiện chọn (bằng/khác/khoảng), và tần suất cập nhật so với truy vấn.
        \item \textbf{Cấu trúc Chỉ mục:} Chỉ mục có thứ tự (B+-Trees) và chỉ mục băm; chỉ mục \textbf{chính/phân cụm} (quy định thứ tự vật lý; tối đa một trên mỗi tập tin) so với chỉ mục \textbf{phụ}.
        \item \textbf{Tối ưu hóa Truy vấn:} Dựa trên chi phí (thống kê) và các quy tắc kinh nghiệm (đẩy phép chọn/chiếu xuống sớm) để chọn kế hoạch hiệu quả.
    \end{itemize}
    \subsection{Các bước vẽ ERD (Steps to Create ERD)}
    \begin{enumerate}[leftmargin=*, label={\textbf{\arabic*.}}]
        \item \textbf{Xác định Thực thể (Entities):} 
        \newline Tìm các \textit{danh từ} (Nouns) quan trọng trong yêu cầu (Vd: Employee, Student). Tránh nhầm lẫn thuộc tính là thực thể.
        
        \item \textbf{Xác định Mối kết hợp (Relationships):} 
        \newline Tìm các \textit{động từ} (Verbs) kết nối các thực thể (Vd: Works\_for, Teaches).
        
        \item \textbf{Xác định Thuộc tính (Attributes):} 
        \newline Xác định thông tin chi tiết cho mỗi thực thể. Xác định thuộc tính đa trị, dẫn xuất, phức hợp.
        
        \item \textbf{Xác định Khóa chính (Primary Keys):} 
        \newline Chọn thuộc tính định danh duy nhất cho mỗi thực thể và gạch chân nó.
        
        \item \textbf{Xác định Bản số (Cardinality Ratio):} 
        \newline Phân tích số lượng tham gia: 1:1, 1:N, hay M:N.
        
        \item \textbf{Xác định Ràng buộc tham gia (Participation):} 
        \newline Có bắt buộc không? (Total - Nét đôi) hay Tùy chọn? (Partial - Nét đơn).
        \newline \textit{Hỏi: "Thực thể A có thể tồn tại mà không cần B không?"}
        
        \item \textbf{Vẽ phác thảo \& Tinh chỉnh:} 
        \newline Vẽ sơ đồ, loại bỏ các thuộc tính dư thừa. Chuyển quan hệ M:N thành thực thể liên kết nếu cần thiết.
    \end{enumerate}
    \subsection{Ký hiệu Chen \& EER (Chen Notation)}
    % Bảng cho Thực thể & Thuộc tính - Tiết kiệm không gian hơn liệt kê
    \subsubsection{Thực thể \& Thuộc tính (Entities \& Attributes)}
    \textit{Khi nào dùng:} \textbf{Thực thể} cho đối tượng độc lập (NhanVien, SanPham, KhanhHang); \textbf{Thực thể yếu} cho đối tượng phụ thuộc (NguoiPhuThuoccủa nhân viên, ChiTietDonHang); \textbf{Khóa} là định danh duy nhất (MSNV, CCCD); \textbf{Đa trị} cho thuộc tính nhiều giá trị (số điện thoại, email); \textbf{Dẫn xuất} cho giá trị tính toán (tuổi từ ngày sinh, tổng tiền).
    \begin{center}
        \begin{tabular}{@{} c c @{}}
            % Hàng 1: Thực thể & Thực thể yếu
            \includegraphics[width=0.45\linewidth, height=1.2cm, keepaspectratio]{./images/chen_entity.png}      &
            \includegraphics[width=0.45\linewidth, height=1.2cm, keepaspectratio]{./images/chen_weak_entity.png}                                \\
            \footnotesize (Thực thể)                                                                             & \footnotesize (Thực thể yếu) \\[2pt]

            % Hàng 2: Thuộc tính & Khóa
            \includegraphics[width=0.45\linewidth, height=1.2cm, keepaspectratio]{./images/chen_attribute.png}   &
            \includegraphics[width=0.45\linewidth, height=1.2cm, keepaspectratio]{./images/chen_key.png}                                        \\
            \footnotesize (Thuộc tính)                                                                           & \footnotesize (Khóa)         \\[2pt]

            % Hàng 3: Đa trị & Dẫn xuất
            \includegraphics[width=0.45\linewidth, height=1.2cm, keepaspectratio]{./images/chen_multivalued.png} &
            \includegraphics[width=0.45\linewidth, height=1.2cm, keepaspectratio]{./images/chen_derived.png}                                    \\
            \footnotesize (Đa trị)                                                                               & \footnotesize (Dẫn xuất)     \\
        \end{tabular}
    \end{center}

    \subsubsection{Mối kết hợp (Relationships)}
    \textit{Khi nào dùng:} \textbf{Quan hệ thường} cho liên kết độc lập (NhanVien \textit{làm việc cho} PhongBan, KhanhHang \textit{mua} SanPham); \textbf{Quan hệ xác định} khi thực thể yếu phụ thuộc vào thực thể chủ (NguoiPhuThuoc \textit{thuộc về} NhanVien với khóa bộ phận là tên người phụ thuộc).
    \begin{center}
        % Dùng minipage để căn chỉnh nếu ảnh có tỷ lệ khác nhau
        \includegraphics[width=0.9\linewidth]{./images/chen_relationships_summary.png} \\
        \footnotesize \textit{Bao gồm: Quan hệ (Hình thoi), Quan hệ xác định (Thoi đôi)}
    \end{center}
    
    \subsubsection{Ràng buộc (Constraints)}
    \textit{Khi nào dùng:} Xác định quy tắc nghiệp vụ giữa các thực thể.
    \begin{itemize}[leftmargin=*, label={}]
        \item \textbf{Bản số (Cardinality):} 1:1 (NhanVien \textit{quản lý} PhongBan - mỗi phòng có 1 trưởng), 1:N (PhongBan \textit{có} NhanVien - nhiều nhân viên/phòng), M:N (NhanVien \textit{tham gia} DUAN - nhiều-nhiều).
        \item \textbf{Tham gia (Participation):}
              \begin{center}
                  \includegraphics[width=0.85\linewidth]{./images/chen_participation.png} \\
                  \footnotesize (Partial Participation (Từng phần): Nét đơn \linebreak Total Participation (Toàn phần): Nét đôi)
              \end{center}
        \item \textbf{Min-Max (min, max):} Ghi cặp số trên cạnh. Ví dụ: NhanVien $(1,1)$ \textit{làm việc cho} $(0,N)$ PhongBan nghĩa là mỗi nhân viên bắt buộc làm việc cho đúng 1 phòng ban, mỗi phòng ban có thể có 0 đến nhiều nhân viên. $(0,1)$: tùy chọn, tối đa 1; $(1,N)$: bắt buộc, có thể nhiều. (An extension of Participation và Cardinality)
    \end{itemize}

    \subsubsection{EER Chuyên biệt hóa \& Tổng quát hóa}
    \textit{Khi nào dùng:} \textbf{Disjoint} khi lớp con không chồng lấp (NhanVien là KỸ SƯ hoặc QUẢN LÝ, không đồng thời); \textbf{Overlapping} khi có thể thuộc nhiều lớp (NGƯỜI là SINH VIÊN và/hoặc NHÂN VIÊN); \textbf{Union} khi lớp con kế thừa từ nhiều lớp cha (CHỦ SỞ HỮU có thể là NGƯỜI hoặc CÔNG TY hoặc NGÂN HÀNG). \textbf{Total} khi mọi thực thể cha phải thuộc ít nhất 1 lớp con; \textbf{Partial} khi không bắt buộc.
    \begin{center}
        \begin{tabular}{@{} c @{}}
            \includegraphics[width=1\linewidth]{./images/chen_eer_disjoint_overlap.png} \\
            \footnotesize (Disjoint \& Overlapping)                                       \\[2pt]
            \includegraphics[width=1\linewidth]{./images/chen_eer_union.png}            \\
            \footnotesize (Union)                                                         \\
        \end{tabular} \\[2pt]
        \footnotesize \textit{Ký hiệu: Hình tròn (d: disjoint, o: overlapping, U: union),\linebreak Nét đôi (Total), Nét đơn (Partial).}
    \end{center}
    
    \section{Lưu trữ Dữ liệu \& Chỉ mục}

    % ============================================================================
    % PART 1: FOUNDATIONAL CONCEPTS
    % ============================================================================
    \subsection{Cơ bản về Chỉ mục}

    \subsubsection{Chỉ mục là gì?}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Mục đích:} Tăng tốc độ truy xuất dữ liệu bằng cách tạo đường dẫn phụ trợ đến các bản ghi.
        \item \textbf{Khóa tìm kiếm:} (Các) thuộc tính dùng để tìm bản ghi; không nhất thiết là khóa chính; có thể là khóa phức hợp (nhiều cột).
        \item \textbf{Đánh đổi:} Đọc nhanh hơn so với ghi chậm hơn (chi phí bảo trì chỉ mục khi INSERT/UPDATE/DELETE).
    \end{itemize}

    \subsubsection{Phân loại Chỉ mục}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Theo Cấu trúc:}
              \begin{itemize}
                  \item \textit{Có thứ tự (Ordered):} Các mục được sắp xếp (vd: B+-tree); hỗ trợ truy vấn khoảng.
                  \item \textit{Băm (Hash):} Khóa được băm vào bucket; chỉ nhanh khi tìm kiếm chính xác (dấu bằng).
              \end{itemize}
        \item \textbf{Theo Mật độ:}
              \begin{itemize}
                  \item \textit{Đặc (Dense):} Một mục chỉ mục cho mỗi giá trị khóa tìm kiếm riêng biệt.
                  \item \textit{Thưa (Sparse):} Một mục chỉ mục cho mỗi khối (hoặc mỗi giá trị phân cụm); nhỏ hơn, chi phí bảo trì thấp hơn.
              \end{itemize}
        \item \textbf{Theo Thứ tự Vật lý:}
              \begin{itemize}
                  \item \textit{Chỉ mục Chính/Phân cụm:} Khóa tìm kiếm quyết định thứ tự vật lý của tập tin (tối đa một per bảng); thường là chỉ mục thưa.
                  \item \textit{Chỉ mục Phụ:} Đường dẫn truy cập thay thế độc lập với thứ tự vật lý; thường là chỉ mục đặc hoặc dùng gián tiếp cho các khóa không duy nhất.
              \end{itemize}
    \end{itemize}

    % ============================================================================
    % PART 2: CORE INDEX STRUCTURES
    % ============================================================================
    \subsection{B-Trees \& B+-Trees}

    \subsubsection{Tại sao dùng B+-Trees?}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Mục tiêu:} Giảm thiểu I/O đĩa tốn kém bằng cách giữ chiều cao cây thấp thông qua hệ số rẽ nhánh (fan-out) cao.
        \item \textbf{Cấu trúc:} Cây cân bằng; nút trong chứa khóa + con trỏ con; nút lá chứa khóa + con trỏ dữ liệu (hoặc ID bản ghi) + liên kết đến lá kế tiếp.
        \item \textbf{Thao tác:} Tìm/thêm/xóa trong $O(\log_{fo} n)$ lần truy cập khối; tách/gộp nút để duy trì cân bằng.
        \item \textbf{B+- so với B-Tree:} B+- chỉ lưu con trỏ dữ liệu ở lá $\Rightarrow$ hệ số rẽ nhánh nút trong cao hơn, quét tuần tự hiệu quả qua chuỗi liên kết lá.
    \end{itemize}
    
    

    \subsubsection{Ví dụ Tính Dung lượng}
    \textit{Tham số:} Kích thước khối $B=512$ bytes; kích thước khóa $V=9$ bytes; con trỏ dữ liệu $\Pr=7$ bytes; con trỏ cây $P=6$ bytes.

    \paragraph{Bước 1: Tính Bậc (Số con trỏ tối đa mỗi nút)}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Nút trong B-Tree:} Chứa $p$ con trỏ cây + $(p-1)$ khóa + $(p-1)$ con trỏ dữ liệu.
        \item[] $(p \times 6) + ((p-1) \times (7+9)) \le 512$
        \item[] $6p + 16p - 16 \le 512 \quad \Rightarrow \quad 22p \le 528 \quad \Rightarrow \quad p = 23$

        \item \textbf{Nút trong B+-Tree:} Chứa $p$ con trỏ cây + $(p-1)$ khóa (không có con trỏ dữ liệu).
        \item[] $(p \times 6) + ((p-1) \times 9) \le 512$
        \item[] $6p + 9p - 9 \le 512 \quad \Rightarrow \quad 15p \le 521 \quad \Rightarrow \quad p = 34$

        \item \textbf{Nút lá B+-Tree:} Chứa $p_{leaf}$ cặp khóa/con trỏ dữ liệu + 1 con trỏ kế tiếp.
        \item[] $(p_{leaf} \times (7+9)) + 6 \le 512$
        \item[] $16 \times p_{leaf} \le 506 \quad \Rightarrow \quad p_{leaf} = 31$
    \end{itemize}

    \paragraph{Bước 2: Ước lượng Tổng dung lượng (Đầy 69\%)}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{B-Tree (3 mức):} Hệ số rẽ nhánh trung bình $fo = 23 \times 0.69 \approx 16$.
              \begin{itemize}
                  \item Mức 0 (gốc): 15 mục, 16 con trỏ
                  \item Mức 1: $16 \times 15 = 240$ mục
                  \item Mức 2: $256 \times 15 = 3{,}840$ mục
                  \item \textbf{Tổng:} $15 + 240 + 3{,}840 \approx \mathbf{4{,}095}$ mục
              \end{itemize}

        \item \textbf{B+-Tree (3 mức):} Nút trong $fo = 34 \times 0.69 \approx 23$; Dung lượng lá $= 31 \times 0.69 \approx 21$.
              \begin{itemize}
                  \item Mức 0: 22 mục, 23 con trỏ
                  \item Mức 1: $23 \times 22 = 506$ mục, 529 con trỏ
                  \item Mức lá: $12{,}167 \times 21 \approx \mathbf{255{,}507}$ con trỏ dữ liệu
              \end{itemize}

        \item \textbf{Nhận xét:} B+- chứa được $\sim 4\times$ số mục ở cùng chiều cao nhờ nút trong nhẹ hơn.
    \end{itemize}

    \subsubsection{Các loại Chỉ mục Nâng cao}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Chỉ mục Phức hợp:} Khóa nhiều cột (vd: (City, LastName)); hỗ trợ truy vấn tiền tố trái nhất (City), (City, LastName); sắp xếp cột theo độ chọn lọc.
        \item \textbf{Chỉ mục Dựa trên Hàm:} Chỉ mục trên biểu thức (vd: \texttt{LOWER(email)}); truy vấn phải dùng đúng hàm đó mới tận dụng được.
    \end{itemize}

    % ============================================================================
    % PART 3: SPECIALIZED STRUCTURES
    % ============================================================================
    \subsection{Chỉ mục Băm \& Bitmap}

    \subsubsection{Chỉ mục Băm (Hash Indexes)}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Sử dụng:} Tìm kiếm chính xác cực nhanh (truy vấn điểm); không hỗ trợ khoảng.
        \item \textbf{Xử lý đụng độ:} Dùng danh sách liên kết (chaining) với bucket tràn.
        \item \textbf{Biến thể động:} Băm mở rộng/tuyến tính (Extendible/Linear hashing) tăng trưởng dần mà không cần xây lại toàn bộ.
    \end{itemize}
    
    \subsubsection{Chỉ mục Bitmap}
    \textit{Tối ưu cho thuộc tính có độ chọn lọc thấp (ít giá trị riêng biệt).}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Cấu trúc:} Đánh số thứ tự bản ghi (0, 1, 2, ...); mỗi giá trị riêng biệt có một bitmap; bit $i=1$ nếu bản ghi $i$ có giá trị đó.
        \item \textbf{Ví dụ (bảng 5 dòng):}
              \begin{itemize}
                  \item \texttt{gender='m'}: 10010 \quad \texttt{gender='f'}: 01101
                  \item \texttt{income='L1'}: 11000 \quad \texttt{income='L2'}: 00100
              \end{itemize}
        \item \textbf{Truy vấn: gender='f' AND income='L2'}
        \item[] $01101 \; \text{AND} \; 00100 = 00100 \quad \Rightarrow \quad \text{bản ghi 2}$
        \item \textbf{Ưu điểm:} Gọn nhẹ (1 triệu dòng = 125 KB mỗi bitmap); thao tác bitwise nhanh; hiệu quả cho bộ lọc nhiều điều kiện; hỗ trợ COUNT qua đếm bit.
    \end{itemize}

    % ============================================================================
    % PART 4: QUERY COST MODELING
    % ============================================================================
    \subsection{Tối ưu hóa Truy vấn \& Phân tích Chi phí}

    \subsubsection{Đo lường Chi phí \& Thông tin Catalog}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Độ đo chính (I/O):} Giảm thiểu chuyển khối ($b$) và truy cập ngẫu nhiên (seek $S$). Thời gian: $b \times t_T + S \times t_S$.
        \item \textbf{Kích thước quan hệ:} $r$ = số bộ, $b$ = số khối tập tin.
        \item \textbf{Chi tiết chỉ mục:} $x$ = chiều cao chỉ mục đa mức (vd: B+-tree), $b_{I1}$ = số khối chỉ mục mức 1.
        \item \textbf{Hệ số khối (Blocking factor):} $bfr$ = số bộ trên mỗi khối.
        \item \textbf{Số lượng chọn (Selection cardinality):} $s = sl \times r$ với $sl$ là độ chọn lọc (selectivity).
        \item \textbf{Số giá trị phân biệt:} $NDV(A)$ = số giá trị khác nhau của thuộc tính $A$.
    \end{itemize}

    \subsubsection{Hàm Chi phí cho Phép Chọn}
    \textit{Phép chọn ($\sigma$) có thể dùng quét tập tin hoặc truy cập chỉ mục/băm tùy đường dẫn có sẵn. Chi phí chưa tính việc ghi kết quả.}
    \paragraph{\textbf{S1: Tìm kiếm Tuyến tính (Vét cạn / A1)}}
    \begin{itemize}[leftmargin=*, label={--}]
        \item Trường hợp xấu nhất/không khóa: $\mathbf{C_{S1a} = b}$.
        \item Trung bình tìm bằng trên khóa: $\mathbf{C_{S1b} = b/2}$ (dừng khi thấy).
    \end{itemize}
    \paragraph{\textbf{S2: Tìm kiếm Nhị phân (tập tin có thứ tự)}}\mbox{}\\
    $\mathbf{C_{S2} = \log_2 b + \lceil s/bfr \rceil - 1}$.
    \paragraph{\textbf{S3a: Chỉ mục Chính (một bản ghi)}}\mbox{}\\
    $\mathbf{C_{S3a} = x + 1}$.
    \paragraph{\textbf{S3b: Khóa Băm (một bản ghi)}}\mbox{}\\
    $\mathbf{C_{S3b} = 1}$ (tĩnh/tuyến tính) hoặc $\mathbf{2}$ (mở rộng).
    \paragraph{\textbf{S5: Chỉ mục Phân cụm (bằng trên không khóa / A3)}}\mbox{}\\
    $\mathbf{C_{S5} = x + \lceil s/bfr \rceil}$.
    \paragraph{\textbf{S6a: Chỉ mục Phụ (bằng trên không khóa / A4)}}\mbox{}\\
    $\mathbf{C_{S6a} = x + 1 + s}$ (trường hợp xấu nhất, bản ghi phân tán).
    \paragraph{\textbf{S6b: Chỉ mục Phụ (truy vấn khoảng)}}\mbox{}\\
    $\mathbf{C_{S6b} = x + (b_{I1}/2) + (r/2)}$.\\

    \textit{Lưu ý: Chi phí thời gian thường mô hình hóa là $b \times t_T + S \times t_S$, tách biệt truyền dữ liệu và tìm kiếm đầu từ.}

    \subsubsection{Ví dụ: Phép chọn trên EMPLOYEE}
    \textit{Kịch bản:} EMPLOYEE có $r_E=10{,}000$, $b_E=2{,}000$, $bfr_E=5$. Các chỉ mục/đường dẫn có sẵn:
    \begin{itemize}
        \item \textbf{Salary} (phân cụm, không khóa): $x=3$, $s_{Salary}=20$.
        \item \textbf{Ssn} (phụ, khóa): $x=4$, $s_{Ssn}=1$.
        \item \textbf{Dno} (phụ, không khóa): $x=2$, $s_{Dno}=80$ (từ $10{,}000/125$).
        \item \textbf{Sex} (phụ, không khóa): $x=1$, $s_{Sex}=5{,}000$ (từ $10{,}000/2$).
    \end{itemize}

    \paragraph{OP1: Tìm bằng trên Khóa}\mbox{}\\
    Truy vấn: $\sigma_{\text{Ssn}='123456789'}(\text{EMPLOYEE})$.
    \begin{itemize}[leftmargin=*, label={--}]
        \item S1b (tuyến tính tb): $C_{S1b} = b_E/2 = 1{,}000$.
        \item S6a (chỉ mục phụ trên khóa): $C_{S6a} = x_{Ssn} + 1 = 4 + 1 = \mathbf{5}$.
        \item \textbf{Quyết định:} Chọn S6a (5 $\ll$ 1{,}000).
    \end{itemize}

    \paragraph{OP3: Tìm bằng trên Không khóa}\mbox{}\\
    Truy vấn: $\sigma_{\text{Dno}=5}(\text{EMPLOYEE})$.
    \begin{itemize}[leftmargin=*, label={--}]
        \item S1a (tuyến tính): $C_{S1a} = b_E = \mathbf{2{,}000}$.
        \item S6a (phụ trên Dno): $C_{S6a} = x_{Dno} + s_{Dno} = 2 + 80 = \mathbf{82}$.
        \item \textbf{Quyết định:} Chọn S6a (82 $\ll$ 2{,}000). Nếu có chỉ mục phân cụm trên Dno: $3 + \lceil 80/5 \rceil = 19$ khối.
    \end{itemize}

    \paragraph{OP4: Phép chọn Hội (Nhiều điều kiện)}\mbox{}\\
    Truy vấn: $\sigma_{\text{Dno}=5 \land \text{Salary}>30\,000 \land \text{Sex}='F'}(\text{EMPLOYEE})$.
    Bộ tối ưu so sánh các đường dẫn truy cập để lấy tập ứng viên ban đầu, sau đó kiểm tra các vị từ còn lại trong RAM.
    \begin{itemize}[leftmargin=*, label={--}]
        \item Qua Dno (S6a): $C = x_{Dno} + s_{Dno} = \mathbf{82}$.
        \item Qua khoảng Salary (phân cụm): $C \approx x_{Salary} + (b_E/2) = 3 + 1{,}000 =
                  \mathbf{1{,}003}$.
        \item Qua Sex (S6a): $C = x_{Sex} + s_{Sex} = 1 + 5{,}000 = \mathbf{5{,}001}$.
        \item Vét cạn (S1a): $C = 2{,}000$.
        \item \textbf{Quyết định:} Dùng chỉ mục Dno (82), lấy 80 bộ, sau đó lọc $\text{Salary}>30\,000$ và $\text{Sex}='F'$ trong RAM.
    \end{itemize}

    \subsubsection{Thuật toán Kết nối (Join) \& So sánh Chi phí}

    \paragraph{Tham số Chính}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Độ chọn lọc kết nối:} $js = |R \bowtie S|/(|R|\,|S|)$; với equi-join $js \approx 1/\max(NDV(A), NDV(B))$.
        \item \textbf{Số bộ kết quả:} $jc = js\,|R|\,|S|$; \textbf{chi phí ghi}: $jc/bfr_{result}$ khối.
        \item \textbf{Bộ đệm:} $n_B$ = số trang đệm khả dụng (ảnh hưởng chi phí nested-loop).
    \end{itemize}
    
    \paragraph{Kịch bản Thống nhất (Join)}\mbox{}\\
    EMPLOYEE ($|E|=10{,}000$, $b_E=2{,}000$) $\bowtie_{Dno=Dnumber}$ \\
    DEPARTMENT ($|D|=125$, $b_D=13$). \\
    Chỉ mục trên $E.Dno$ (phụ: $x=2$, $s=80$).\\
    $Dnumber$ là khóa chính ($x=1$).\\
    Giả sử $js=1/125$, $jc=10{,}000$, $bfr_{result}=4$ (chi phí ghi $=2{,}500$ khối), $n_B=3$.

    \paragraph{J1: Block Nested-Loop}\mbox{}\\
    Chi phí: $C_{J1} = b_R + \left\lceil \frac{b_R}{n_B - 2} \right\rceil b_S + \frac{jc}{bfr_{result}}$.
    Dùng DEPARTMENT làm vòng ngoài: $C_{J1} = 13 + \lceil 13/1\rceil \times 2{,}000 + 2{,}500 = \mathbf{28{,}513}$.

    \paragraph{J2: Indexed Nested-Loop}\mbox{}\\
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{DEPARTMENT ngoài $\to$ EMPLOYEE trong:} Mỗi lần tìm $= x+s = 2+80 = 82$. Tổng $= 13 + 125 \times 82 + 2{,}500 = \mathbf{12{,}763}$.
        \item \textbf{EMPLOYEE ngoài $\to$ DEPARTMENT trong:} Mỗi lần tìm $= x+1 = 1+1 = 2$. Tổng $= 2{,}000 + 10{,}000 \times 2 + 2{,}500 = \mathbf{24{,}500}$.
    \end{itemize}

    \paragraph{J3: Sort-Merge (Trộn sắp xếp)}\mbox{}\\
    Nếu đã sắp xếp: \[C_{J3} = b_E + b_D + \frac{jc}{bfr_{result}} = 2{,}000 + 13 + 2{,}500 = \mathbf{4{,}513}\]. Nếu chưa, cộng thêm chi phí sắp xếp ngoài mỗi quan hệ.

    \paragraph{J4: Partition-Hash (Băm phân hoạch)}\mbox{}\\
    Chi phí xấp xỉ: $C_{J4} \approx 3\,(b_E + b_D) + \frac{jc}{bfr_{result}} = 3\times(2{,}000+13) + 2{,}500 = \mathbf{8{,}539}$.

    \paragraph{Quyết định Kế hoạch}\mbox{}\\
    J3 (nếu đã sắp xếp) $<$ J4 $<$ J2\,(D ngoài) $<$ J2\,(E ngoài) $<$ J1. Ưu tiên Hash Join khi chưa sắp xếp; ưu tiên Sort-Merge khi đã có thứ tự.

    % ============================================================================
    % PART 5: OPTIMIZATION STRATEGIES
    % ============================================================================
    \subsection{Quy trình Tối ưu hóa Truy vấn}

    \subsubsection{Tổng quan Quy trình}
    \begin{enumerate}[leftmargin=*]
        \item \textbf{Phân tích \& Kiểm tra (Parse):} Kiểm tra cú pháp, tuân thủ lược đồ.
        \item \textbf{Dịch (Translate):} Chuyển SQL sang đại số quan hệ (cây truy vấn).
        \item \textbf{Tối ưu hóa Kinh nghiệm (Heuristic):} Áp dụng các quy tắc biến đổi.
        \item \textbf{Tối ưu hóa Dựa trên Chi phí:} Liệt kê các kế hoạch, ước tính chi phí, chọn chi phí thấp nhất.
        \item \textbf{Thực thi:} Hiện thực hóa kết quả trung gian hoặc pipeline kết quả.
    \end{enumerate}
    
    \subsubsection{Quy tắc Heuristic}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Đẩy phép chọn ($\sigma$) xuống:} Lọc sớm để giảm kích thước trung gian.
        \item \textbf{Đẩy phép chiếu ($\Pi$) xuống:} Giảm chiều rộng bộ dữ liệu sớm.
        \item \textbf{Thay thế $\sigma$ + Tích đề-các ($\times$) bằng Kết ($\bowtie$):} Tránh tích đề-các tốn kém.
        \item \textbf{Sắp xếp lại thứ tự kết:} Dùng tính giao hoán/kết hợp để tìm kết quả trung gian có lực lượng thấp.
        \item \textbf{Cây nghiêng trái (Left-deep trees):} Con phải luôn là bảng cơ sở $\Rightarrow$ cho phép tìm kiếm chỉ mục, giảm không gian tìm kiếm.
    \end{itemize}

    \subsubsection{Quyết định Dựa trên Chi phí}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Chọn đường dẫn truy cập:} So sánh quét toàn bộ, chỉ mục phân cụm, chỉ mục phụ, bitmap cho mỗi vị từ.
        \item \textbf{Thuật toán kết nối:} Nested-loop (index/block), hash join, sort-merge dựa trên số lượng bộ và bộ nhớ.
        \item \textbf{Thứ tự kết nối:} Ước lượng độ chọn lọc kết nối $js \approx 1/\max(NDV(A), NDV(B))$; số lượng $jc = js \times |R| \times |S|$.
    \end{itemize}

    \subsection{Kỹ thuật Chuyên biệt}

    \subsubsection{Cấu trúc Tối ưu Ghi}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{LSM-Tree:} Bộ đệm trong RAM (memtable) + các mức đĩa đã sắp xếp; ghi tuần tự; nén định kỳ; Bloom filter để bỏ qua các mức.
        \item \textbf{Buffer Tree:} Biến thể B-tree với bộ đệm ghi tại mỗi nút; gom nhóm các thay đổi xuống cây; độ trễ đọc tốt hơn LSM.
    \end{itemize}

    \subsubsection{Truy cập Không gian \& Đa khóa}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Đa khóa:} Chỉ mục phức hợp cho truy vấn tiền tố; chỉ mục bao phủ (covering index) tránh tra cứu bảng.
        \item \textbf{Không gian:} R-tree (hình chữ nhật bao), kd-tree, quadtree cho dữ liệu địa lý/khoảng; hỗ trợ truy vấn vùng + lân cận gần nhất.
    \end{itemize}

    % ============================================================================
    % PART 6: ADVANCED TOPICS
    % ============================================================================
    \section{Big Data \& Data Engineering}

    % --- PHẦN 1: KHÁI NIỆM CỐT LÕI ---
    \subsection{Khái niệm Cốt lõi (Core Concepts)}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{5V Big Data:} 
        \begin{itemize}
            \item \textbf{Volume:} Dung lượng lớn (TB $\to$ PB).
            \item \textbf{Velocity:} Tốc độ sinh/xử lý nhanh (Streaming).
            \item \textbf{Variety:} Đa dạng (Cấu trúc, bán cấu trúc JSON, phi cấu trúc).
            \item \textbf{Veracity:} Độ tin cậy/nhiễu của dữ liệu.
            \item \textbf{Value:} Giá trị chuyển hóa thành lợi ích kinh doanh.
        \end{itemize}
        \item \textbf{CAP Theorem:} Chỉ đạt được 2/3: \textbf{C}onsistency, \textbf{A}vailability, \textbf{P}artition Tolerance.
        \newline $\rightarrow$ \textit{NoSQL thường chọn AP (Sẵn sàng + Chịu lỗi) thay vì CP.}
        \item \textbf{BASE:} \textbf{B}asically \textbf{A}vailable, \textbf{S}oft state, \textbf{E}ventual consistency (Nhất quán cuối cùng - chấp nhận dữ liệu cũ tạm thời).
    \end{itemize}

    % --- PHẦN 2: HỆ SINH THÁI HADOOP ---
    \subsection{Hệ sinh thái Hadoop (Hadoop Ecosystem)}
    \textit{Khung làm việc mã nguồn mở cho lưu trữ và xử lý phân tán.}
    \begin{enumerate}[leftmargin=*, label={\textbf{\arabic*.}}]
        \item \textbf{HDFS (Storage):} Hệ thống tệp phân tán.
        \begin{itemize}
            \item \textit{NameNode:} Quản lý metadata (vị trí block).
            \item \textit{DataNode:} Lưu trữ block dữ liệu thực tế.
            \item \textit{Cơ chế:} Chia file thành block (128MB), replicate (x3) để chịu lỗi.
        \end{itemize}
        \item \textbf{YARN (Resource Management):} "Hệ điều hành" của cluster.
        \begin{itemize}
            \item Phân phối tài nguyên (RAM, CPU) cho các ứng dụng.
            \item Cho phép chạy nhiều engine (Spark, MapReduce) trên cùng 1 cụm.
        \end{itemize}
        \item \textbf{MapReduce (Processing):} Mô hình xử lý Batch.
        \begin{itemize}
            \item \textit{Map:} Xử lý song song cục bộ.
            \item \textit{Reduce:} Tổng hợp kết quả.
        \end{itemize}
    \end{enumerate}

    % --- PHẦN 3: CÔNG NGHỆ LƯU TRỮ NOSQL ---
    \subsection{Công nghệ NoSQL (Storage Tech)}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Document (MongoDB):} Schema-on-read (JSON/BSON). Linh hoạt, tốt cho CMS, Mobile apps. Query: \texttt{find()}.
        \item \textbf{Key-Value (Redis):} In-memory, cực nhanh ($<1$ms). Dùng cho Caching, Session, Queue. Persist dạng Snapshot/AOF.
        \item \textbf{Wide-Column (Cassandra/HBase):} Ghi cực nhanh (LSM Tree). Tốt cho Time-series, Log, IoT. Query theo RowKey.
        \item \textbf{Graph (Neo4j):} Tối ưu cho quan hệ phức tạp (Mạng xã hội, Gợi ý, Fraud detection). Query: Cypher.
    \end{itemize}

    % --- PHẦN 4: XỬ LÝ LUỒNG (STREAMING) ---
    \subsection{Xử lý Luồng (Streaming Processing)}
    \textit{Xử lý dữ liệu liên tục, độ trễ thấp (Real-time).}
    
    \subsubsection{Các chiến lược xử lý (Strategies)}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Thời gian (Time Domain):}
        \begin{itemize}
            \item \textit{Event Time:} Thời gian sự kiện xảy ra (quan trọng nhất).
            \item \textit{Processing Time:} Thời gian hệ thống nhận được dữ liệu.
            \item \textit{Watermark:} Cơ chế xử lý độ trễ (data đến muộn) trong Event Time.
        \end{itemize}
        \item \textbf{Cửa sổ (Windowing):}
        \begin{itemize}
            \item \textit{Tumbling:} Cố định, không chồng (vd: mỗi 5p).
            \item \textit{Hopping/Sliding:} Có chồng lấp (vd: 5p, trượt mỗi 1p).
            \item \textit{Session:} Dựa trên hoạt động người dùng (hết timeout thì đóng).
        \end{itemize}
        \item \textbf{Đảm bảo (Guarantees):}
        \begin{itemize}
            \item \textit{At-most-once:} Gửi 1 lần, chấp nhận mất (vd: Log).
            \item \textit{At-least-once:} Không mất, chấp nhận trùng lặp.
            \item \textit{Exactly-once:} Chính xác 1 lần (Khó nhất, cần Flink/Kafka).
        \end{itemize}
    \end{itemize}

    % --- PHẦN 5: PIPELINES & ORCHESTRATION ---
    \subsection{Pipelines \& Orchestration}
    
    \subsubsection{Apache Kafka vs Airflow}
\begin{center}
    \renewcommand{\arraystretch}{1.2} % Adjust row height for readability
    \begin{tabular}{@{} >{\raggedright\arraybackslash}p{0.48\linewidth} >{\raggedright\arraybackslash}p{0.48\linewidth} @{}}
        \toprule
        \textbf{Apache Kafka} & \textbf{Apache Airflow} \\
        \midrule
        
        \textbf{Loại:} Event Streaming Platform (Message Broker). & 
        \textbf{Loại:} Workflow Orchestration (Quản lý quy trình). \\
        \addlinespace[4pt] % Extra space between sections
        
        \textbf{Đặc trưng:}
        \begin{itemize}[leftmargin=10pt, nosep, label=\tiny$\bullet$]
            \item Log bền vững (Durable log).
            \item Decoupling (Tách rời).
            \item Replayable, High throughput.
        \end{itemize} & 
        \textbf{Đặc trưng:}
        \begin{itemize}[leftmargin=10pt, nosep, label=\tiny$\bullet$]
            \item Code-as-infra (Python DAGs).
            \item Quản lý dependency phức tạp.
            \item Backfill (chạy lại quá khứ).
        \end{itemize} \\
        \addlinespace[4pt]
        
        \textbf{Vai trò:} "Xương sống" vận chuyển dữ liệu \textit{Real-time}. & 
        \textbf{Vai trò:} "Nhạc trưởng" điều phối Job (\textit{Batch/ETL}). \\
        \bottomrule
    \end{tabular}
\end{center}

    \subsubsection{ETL vs ELT}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{ETL (Extract-Transform-Load):} Transform \textit{trước} khi vào kho. Schema-on-write. Dữ liệu sạch, bảo mật. (Truyền thống).
        \item \textbf{ELT (Extract-Load-Transform):} Load raw vào kho \textit{trước}, transform sau. Schema-on-read. Tận dụng sức mạnh Cloud DW (BigQuery, Snowflake). (Hiện đại).
    \end{itemize}

    % --- PHẦN 6: DATA WAREHOUSING ---
    \subsection{Kho Dữ liệu (Data Warehousing)}
    
    \subsubsection{Mô hình hóa (Modeling)}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Star Schema:} Fact ở giữa, Dimension xung quanh. Phi chuẩn hóa dimension. \textit{Hiệu năng cao, dễ query.}
        \item \textbf{Snowflake Schema:} Chuẩn hóa dimension (tách nhỏ). \textit{Tiết kiệm không gian, join phức tạp.}
    \end{itemize}

    \subsubsection{SCD (Slowly Changing Dimensions)}
    \textit{Tại sao cần?} Để đảm bảo báo cáo lịch sử chính xác. Nếu KH chuyển từ HCM ra HN năm 2024, doanh số năm 2020 vẫn phải tính cho HCM.
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Type 1 (Overwrite):} Ghi đè giá trị cũ. \textit{Mất lịch sử.}
        \item \textbf{Type 2 (Add Row):} Thêm dòng mới + cột thời gian (Start/End Date) + cờ (is\_current). \textit{Chuẩn nhất cho DW.}
        \item \textbf{Type 3 (Add Column):} Thêm cột "Previous Value". \textit{Chỉ lưu được 1 giá trị cũ.}
    \end{itemize}

    \subsubsection{DW vs DL vs Lakehouse}
    \begin{itemize}[leftmargin=*, label={--}]
        \item \textbf{Data Warehouse:} Dữ liệu có cấu trúc, cho BI/Reporting.
        \item \textbf{Data Lake:} Dữ liệu thô (Raw), đa dạng, giá rẻ, cho ML/DS.
        \item \textbf{Lakehouse:} Kết hợp (Lưu trữ rẻ của Lake + Quản lý/ACID của Warehouse).
    \end{itemize}
\end{multicols}
\end{document}